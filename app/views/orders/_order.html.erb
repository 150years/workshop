<div id="<%= dom_id order %>" class="card flex flex-col gap">
  <div class="flex items-center justify-between w-full gap">
    <h2 class="font-bold text-2xl">#<%= order.id %></h2>
    <span class="font-bold text-2xl"><%= order.name %></span>
    <div class="badge badge--primary"><%= order.status.humanize %></div>
    <div class="flex items-center gap">
      <%= link_to "Edit", edit_order_path(order), class: "btn" %>
      <%= link_to "Destroy", order, class: "btn", data: { turbo_method: :delete, turbo_confirm: "Are you absolutely sure?" } %>
    </div>
  </div>

  <div class="flex flex-col gap">
    <div class="flex items-center gap">
      <span class="font-bold">Client:</span>
      <span><%= order.client.name %></span>
    </div>
    <div class="flex items-center gap">
      <span class="font-bold">Agent:</span>
      <span><%= order.agent.name %></span>
    </div>

    <span class="font-bold mt-1">Files:</span>&nbsp;
    <div class="flex flex-wrap gap-x-2 gap-y-1">
      <% order.files.each_with_index do |file, index| %>
        <div class="flex items-center gap-1">
          <%= link_to file.filename.to_s, rails_blob_path(file, only_path: true),
                      target: '_blank',
                      class: "text-blue-600 underline hover:text-blue-800" %>

          <%= button_to remove_file_order_path(order_id: order.id, file_id: file.id),
              method: :delete,
              form: { data: { turbo_confirm: "Delete this file?" } },
              class: "flex items-center justify-center w-5 h-5 rounded-full hover:bg-red-600 transition",
              style: "background: transparent; border: none; padding: 0;" do %>
            <%= image_tag "x.svg", class: "w-3 h-3", style: "filter: brightness(0) invert(1);", aria: { hidden: true } %>
          <% end %>

          <% unless index == order.files.size - 1 %><span>,</span><% end %>
        </div>
      <% end %>
    </div>
  </div>

  <div class="flex flex-col gap">
    <!-- üí∞ Order Finance Summary -->
    <div class="my-4 p-4 border rounded-md bg-slate-800 text-white">
      <h3 class="text-lg font-bold mb-2">üí∞ Order Finance Summary</h3>
      <p>–û–±—â–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞: <strong><%= number_to_currency(total_amount) %></strong></p>
      <p>–û–ø–ª–∞—á–µ–Ω–æ: <strong><%= number_to_currency(paid_amount) %></strong></p>
      <p>–û—Å—Ç–∞–ª–æ—Å—å –æ–ø–ª–∞—Ç–∏—Ç—å: <strong><%= number_to_currency(balance_due) %></strong></p>

      <div class="w-full h-4 mt-2 bg-gray-300 rounded-full overflow-hidden">
        <div class="h-full <%= progress_color %>" style="width: <%= progress %>%"></div>
      </div>
      <p class="text-sm mt-1">–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ <%= progress %>% –æ–ø–ª–∞—á–µ–Ω–æ</p>

      <%= link_to "üìÇ –§–∏–Ω–∞–Ω—Å—ã", entries_path(order_id: order.id), class: "btn btn--primary mt-3" %>

      <details class="mt-4">
        <summary class="cursor-pointer underline">–ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–ª–∞—Ç–µ–∂–µ–π</summary>
        <table class="table mt-2">
          <thead>
            <tr>
              <th>–î–∞—Ç–∞</th>
              <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
              <th>–°—É–º–º–∞</th>
            </tr>
          </thead>
          <tbody>
            <% entries.each do |entry| %>
              <tr>
                <td><%= entry.date.strftime('%d.%m.%Y') %></td>
                <td><%= entry.subject %></td>
                <td><%= number_to_currency(entry.postings.debit.sum(:amount)) %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </details>
    </div>

    <span class="font-bold">Order Versions</span>
    <div class="tabs" data-controller="tabs">
      <%= order_version_tabs(order, @order_versions) %>
    </div>
  </div>
</div>
      