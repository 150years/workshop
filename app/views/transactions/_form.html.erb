<%= form_with model: transaction, local: true, html: { multipart: true }, class: "flex flex-col gap-4" do |f| %>
  <%= f.label :date, "Date", class: "label" %>
  <%= f.date_field :date, class: "input" %>

  <%= f.label :description, class: "label" %>
  <%= f.text_field :description, class: "input" %>

  <%= f.label :amount, "Amount", class: "label" %>
  <%= f.number_field :amount, step: 0.01, class: "input" %>

  <%= f.label :type_id, "Type", class: "label" %>
<%= f.select :type_id,
  Transaction.type_ids.keys.map { |key| [key.humanize, key] },
  { include_blank: true },
  class: "input" %>

  <%= f.label :order_id, "Project", class: "label" %>
  <%= f.collection_select :order_id, current_company.orders, :id, :name, { include_blank: true }, class: "input" %>

  <%= f.label :agent_id, "Agent", class: "label" %>
  <%= f.collection_select :agent_id, current_company.agents, :id, :name, { include_blank: true }, class: "input" %>

  <%= f.label :client_id, "Client", class: "label" %>
 <%= f.collection_select :client_id, current_company.clients, :id, :name, { include_blank: true }, class: "input" %>

<%= f.label :files, "Attach files", class: "label" %>
<%= f.file_field :files, multiple: true, class: "input mb-4", direct_upload: true %>
<% if transaction.files.attached? %>
  <ul class="text-sm space-y-1">
    <% transaction.files.each do |file| %>
      <li class="flex items-center justify-between">
        <%= link_to file.filename.to_s, rails_blob_path(file, disposition: "attachment"), target: "_blank" %>
        <%= link_to "❌", destroy_attachment_transaction_path(transaction, attachment_id: file.id),
            method: :delete,
            data: { confirm: "Remove file #{file.filename}?" },
            class: "text-red-500 text-xs" %>
      </li>
    <% end %>
  </ul>
<% end %>

  <%= f.submit class: "btn btn--primary" %>
<% end %>
